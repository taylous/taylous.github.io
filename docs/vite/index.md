# Vite

공식문서 기반으로 학습하고 기록하려고 합니다.

<br/>

## vite를 사용해야 하는 이유

### 1. ESM(ES Modules) 지원하여 빠른 개발 경험 제공

기존엔 `Webpack`, `Rollup`, `Parcel` 과 같은 도구들을 이용해서 번들링 작업을 하였는데,
애플리케이션이 발전함에 따라 극적으로 늘어난 javascript 모듈을 처리하는 데 시간이 오래 걸렸습니다.

그 이유는 어떤 시점에 필요한 모듈만 번들링 되지 않고 모든 파일이 번들링 대상이었기 때문입니다.

vite는 이를 해결하고자 Native ESM을 활용하여 개발 시 즉시 시작 가능한 Dev Server를 제공하고, 브라우저가 이해할 수 없는 서드파티 모듈은 Esbuild를 이용해 빠르게 ESM으로 사전 번들링합니다. 그 결과 기존 번들러 대비 10-100배 빠른 개발 경험을 제공합니다.

### 2. Esbuild를 이용한 디펜던시 사전 번들링

개발 서버 시작 시, node_modules 내의 CommonJS 및 UMD 모듈을 ESM 형식으로 변환하여 브라우저에서 사용할 수 있게 합니다.
또한 ESM 모듈이라 하더라도 중첩 의존성이 많은 경우, 이를 하나의 모듈로 사전 번들링하여 HTTP 요청 수를 줄이고 초기 로딩 성능을 향상시킵니다.

서버가 이미 실행된 이후 새로운 의존성이 추가되거나 변경되면, vite는 의존성 그래프를 다시 분석하여 필요한 번들링만 수행하고, 필요한 경우 자동으로 페이지를 다시 불러옵니다.

### 3. 상황에 맞는 다양한 도구 활용

개발 환경에서 일부 디펜던시를 사전 번들링 하기 위해 Esbuild를 사용하지만
프로덕션 빌드를 위한 번들러로는 `rollup`을 사용합니다.

실행환경에 맞춘 도구 활용을 통해 성능과 편의성 사이의 적절한 트레이드 오프를 이뤄냈습니다.

<br/>

## 지원하는 기능

### 1. npm을 이용한 디펜던시 임포트 그리고 사전 번들링

다음 코드는 네이티브 ES에서 정상적으로 실행되지 않습니다.

```javascript
import { someMethod } from 'my-dep';
```

`Node.js`나 `번들려`환경에서는 잘 동작하지만 네이티브 ES 환경에서는
정확한 경로를 필요로 하기 때문에 `./my-dep.js`와 같은 상대/절대 경로만 이해할 수 있습니다.

그래서 vite가 `사전 번들링` + `경로 변환` 작업을 수행합니다.
`my-dep`이 실제로 `node_modules` 안에 있는 패키지라는 걸 감지하고,
`Esbuild`를 사용해서 ESM 형태로 변환 후 브라우저가 이해할 수 있는 경로로 바꿔줍니다.

```javascript
import { someMethod } from '/@modules/my-dep.js';
// 또는
import { someMethod } from '/node_modules/.vite/deps/my-dep.js';
```

### 2. Hot Module Replacement

vite는 기본적으로 ESM을 통해 HMR API를 제공합니다.

### 3. Typescript

vite는 `.ts` 파일에 대해서 트랜스 파일링만 수행합니다.

그 이유는 타입 검사를 위해 사용되는 tsc[^1]는 프로젝트의 모든 코드들을 분석해서
타입 체크와 컴파일을 수행하기 때문입니다.
전체 코드에 대해서 분석을 실시하면 vite의 이점이 사라지게 됩니다.

그래서 vite는 tsc를 사용하지 않고 Esbuild만 사용하는데
파일 하나만 보고 컴파일을 하기 때문에 다른 파일에 어떤 내용이 있든 신경쓰지 않습니다.

> vite가 타입스크립트 코드를 빠르게 처리하려면, 각 `.ts` 파일이 독립적으로 컴파일 가능하도록 해야합니다.

그렇기 때문에 `isolatedModules`을 `true`로 설정해야합니다.

<br/><br/><br/>

---

[^1]: 타입스크립트 컴파일러
